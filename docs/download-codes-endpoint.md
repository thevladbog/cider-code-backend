# Эндпоинт скачивания кодов

## GET /code/download

Эндпоинт для скачивания кодов в виде текстового файла для указанной смены.

### Параметры запроса

| Параметр       | Тип     | Обязательный | Описание                                               |
| -------------- | ------- | ------------ | ------------------------------------------------------ |
| `shiftId`      | string  | Да           | ID смены для которой нужно скачать коды                |
| `includeBoxes` | boolean | Нет          | Флаг для включения кодов коробок (по умолчанию: false) |

### Логика работы

#### Если `includeBoxes = false` (по умолчанию):

- Выгружаются только индивидуальные коды для указанной смены
- Коды располагаются в файле друг под другом в порядке создания

#### Если `includeBoxes = true`:

- Сначала выгружается SSCC код коробки
- Затем все индивидуальные коды из этой коробки
- Далее следующая коробка и её коды
- После всех коробок добавляются индивидуальные коды, не привязанные к коробкам

### Особые случаи

1. **Коробки не формировались, но флаг `includeBoxes = true`**:

   - Система выгрузит только индивидуальные коды
   - В логах появится предупреждение о том, что коробки не найдены

2. **Смена не найдена**:

   - Возвращается ошибка 404

3. **Нет кодов для смены**:
   - Возвращается пустой файл

### Формат ответа

- **Content-Type**: `text/plain`
- **Content-Disposition**: `attachment; filename="codes_shift_{shiftId}_{date}.txt"`
- **Тело ответа**: Текстовый файл с кодами, разделёнными переносами строк

### Пример использования

```
GET /code/download?shiftId=shift_123&includeBoxes=true
```

### Авторизация

Требуется JWT токен оператора.

### Возможные ошибки

- `400 Bad Request`: Неверный формат входных данных
- `404 Not Found`: Смена не найдена
- `500 Internal Server Error`: Внутренняя ошибка сервера
